# Common Profile
#------------------------------------------------
# Source this file from .bashrc and .zshrc


# Server ID
#------------------------------------------------

#Set the computer name here
FILE=~/.server_name.txt

if [ ! -f "$FILE" ]; then
  echo "Insert a server name in ~/.server_name.txt" > ~/.server_name.txt
else
  # NO-OP
  :
fi

server_name=$(cat ~/.server_name.txt )

# Join Message
echo -e "\e[1;31m$server_name\e[0m"

# Set Windows Terminal Tab Name
echo -ne "\033]0;$server_name\a"


# PATH
#------------------------------------------------

# Add the user's local binaries to the PATH
# if not already present


if [ -d "$HOME/.local/bin" ]; then
  export PATH=$HOME/.local/bin:$PATH
fi
if [ -d "$HOME/bin" ]; then
  export PATH=$HOME/.local/bin:$PATH
fi

# Environment Variables
#------------------------------------------------
export EDITOR='nano'

# Certificates
export SSL_CERT_FILE=/etc/ssl/certs/ca-certificates.crt

# Docker
export STACK_DEPLOY_DETACHED=true

# UV
# export UV_NO_SYNC=1

# Load secrets
source ~/.shell_secrets

# Node Version Manager (NVM)
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"


# Cargo
if [ -f "$HOME/.cargo/env" ]; then
  . "$HOME/.cargo/env"
fi

# Argcomplete
if [ -f "/etc/bash_completion.d/python-argcomplete" ]; then
  . "/etc/bash_completion.d/python-argcomplete"
fi

# General Aliases
#------------------------------------------------
alias path='sed "s/:/\n/g" <<< "$PATH"'

alias editprofile='nano ~/.common_profile'
alias editcommon='editprofile'

# GPU
alias nvitop="uvx nvitop"

# Exa
alias ls="eza --icons --group-directories-first"
alias ll="eza -lah --icons --group-directories-first --long --header --git --group"

# Browsing
alias grep='grep --color'

alias unrar-find='unrar e -r -o- *.rar ./'

# Functions
#------------------------------------------------

# Source all of the custom functions / scripts in /yadm/functions
# This is analogous to how ~/.bashrc.d/ works

if [ -d "$HOME/yadm/functions" ]; then
    # Detect zsh vs bash
    if [ -n "$ZSH_VERSION" ]; then
        # Temporarily enable null_glob so unmatched patterns vanish
        setopt local_options null_glob
    fi

    for rc in "$HOME/yadm/functions"/*.{sh,bash}; do
        [ -f "$rc" ] || continue
        if [ "${YADM_CUSTOM_DEBUG}" = "1" ]; then
            echo "Sourcing: $rc"
        fi
        source "$rc"
    done
fi


# Autocompletions
#------------------------------------------------
# Alacritty
if [ -f "$HOME/.bash_completion/alacritty" ]; then
  . "$HOME/.bash_completion/alacritty"
fi


# Docker
#------------------------------------------------

alias dockerup='docker compose up -d --remove-orphans && docker compose ps && dtop'
alias ddown='docker compose down'
alias dtop='docker ps -q | xargs  docker stats --no-stream && echo "" && echo "" &&  docker ps --format "table {{.ID}}\t{{.Names}}\t{{.Status}}\t{{.Ports}}"'
alias logd='docker logs -tf --tail="200"'
alias ctop='docker run --rm -ti  --volume /var/run/docker.sock:/var/run/docker.sock:ro  quay.io/vektorlab/ctop:latest'



# Development
#------------------------------------------------

alias semvar='semantic-release'

alias semvar-print='semantic-release -v --noop version'

alias act='gh act'

alias ansible-start="docker run -it --rm -w /work -v `pwd`:/work -v $HOME/.ssh/id_ed25519:/root/.ssh/id_ed25519:ro --entrypoint=/bin/sh docker.io/devture/ansible:2.13.6-r0-3"

# Python
#------------------------------------------------

# Virtual Environment
alias venv='source .venv/bin/activate'

alias active-python='~/yadm/scripts/python/active-python.sh'

# SSH
#------------------------------------------------

# Provides the function add-ssh() to add ssh keys to the agent
source ~/yadm/scripts/keychain/keychain_alias.sh

# For interactive shells, load the keychain environment if it exists
source ~/yadm/scripts/keychain/keychain_interactive_shell.sh


# Git
#------------------------------------------------
alias pre-commit='uvx pre-commit'

alias readme='reporoot && pwd && nano --view README.md'

alias gitgraph="git -c log.showSignature=false log --oneline --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)%Creset' --abbrev-commit"
alias gitlog='git log --decorate --all --show-pulls --show-signature --max-count 3 --abbrev-commit'

# Datalad
#------------------------------------------------
alias dl-push="datalad push --to warehouse && datalad push --to origin"


# Tmux / Tmuxinator
#------------------------------------------------
# Note: these functions are already sourced above
# source ~/yadm/functions/tmux_functions.sh

# GPG
#------------------------------------------------
export GPG_TTY=$(tty)

alias gpg-restart='killall gpg-agent && sleep 1 && gpg-connect-agent /bye'

alias gpg-start='echo "Starting GPG" | gpg --clearsign'


# Terminal setup
#------------------------------------------------

# Zoxide
if [ -n "$BASH_VERSION" ]; then
    eval "$(zoxide init bash)"
elif [ -n "$ZSH_VERSION" ]; then
    eval "$(zoxide init zsh)"
else
    echo "Unable to initialize zoxide: Unknown shell"
fi

# System setup
#------------------------------------------------

# Start the nvitop exporter for monitoring GPU usage
if command -v nvidia-smi &> /dev/null; then
  if [[ -o login ]]; then
    bash ~/yadm/scripts/monitoring/nvitop-exporter.sh
  fi
fi

##################################################
# Computer Specific
##################################################

# After loading all configurations
# Run the computer specific config
# For overriding settings

source ~/yadm/shell/computer_specific

#################################################
# MIT License                                   #
#                                               #
# Copyright Â© 2022-2025 Pranav Kumar Mishra     #
#################################################
